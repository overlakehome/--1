#!/usr/bin/env ruby
%w{optparse open-uri JSON}.each { |e| require e }

$options = {}
OptionParser.new do |opts|
  opts.on('-e', '--exponent FLOAT', Float, 'Divides numbers by 10 to the power of the specified # (default: -3).') { |v| $options[:exponent] = v }
end.parse!
exponent = $options[:exponent] || -3.0;

open(ARGV[0]).each do |l|
  t, l = l.split
  h = JSON[l.gsub(%r(([^,{]+)\s*:), %q("\1":))].
    reduce({}) { |h, (k,v)| h[k] = (v / (10 ** exponent)).round(1); h }
  p "%2s (/1k): %s" % [t, h]
end
